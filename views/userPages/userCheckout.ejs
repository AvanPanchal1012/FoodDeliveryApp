<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
      integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
      integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="/static/js/script.js"></script>
</head>

<body>
    <%- include('../partials/navbar', { loginUser: loginUser }) %>
    <section>
        <div class="container-fluid pb-5">
            <%- include('../partials/userBar') %>

            <div class="container userSection">
                <div class="row">
                    <div class="card">
                        <h1>Your Orders</h1>
                    </div>
                    <div class="card">
                        <div class="card-body cart-body"></div>
                        <div id="orderPlaced"></div>

                    </div>
                    <div class="card col-md-3 p-3">
                        <h2>Payment type</h2>
                        <h4 class="text-muted">
                            Cash on delivery : <input type="radio" name="payment" id="offline" onclick="toggleForms()">
                        </h4>
                        <h4 class="text-muted">
                            Online payment : <input type="radio" name="payment" id="online" onclick="toggleForms()">
                        </h4>
                    </div>

                    <div class="col-md-9">
                        <div class="card mb-3 px-3 p-3">
                            <h4>Name : <%= loginUser.name %></h4>
                            <h4>Phone number : <%= loginUser.phone %></h4>
                            <h4>Delivery address : <%= loginUser.address %></h4>
                        </div>
                        <div id="cashOnDeliveryForm" class="card" style="display:none;">
                            <div class="card-body">
                                <h4>Cash on Delivery Information</h4>
                                <form>
                                    <div class="mb-3">
                                        <label for="codName" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="codName" value="<%= loginUser.name %>">
                                    </div>
                                    <div class="mb-3">
                                        <label for="codPhone" class="form-label">Phone Number</label>
                                        <input type="text" class="form-control" id="codPhone" value="<%= loginUser.phone %>">
                                    </div>
                                    <div class="mb-3">
                                        <label for="codAddress" class="form-label">Address</label>
                                        <input type="text" class="form-control" id="codAddress" value="<%= loginUser.address %>">
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div id="onlinePaymentForm" class="card" style="display:none;">
                            <div class="card-body">
                                <h4>Online Payment Information</h4>
                                <form>
                                    <div class="mb-3">
                                        <label for="onlineName" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="onlineName" value="<%= loginUser.name %>">
                                    </div>
                                    <div class="mb-3">
                                        <label for="onlinePhone" class="form-label">Phone Number</label>
                                        <input type="text" class="form-control" id="onlinePhone" value="<%= loginUser.phone %>">
                                    </div>
                                    <div class="mb-3">
                                        <label for="onlineAddress" class="form-label">Address</label>
                                        <input type="text" class="form-control" id="onlineAddress" value="<%= loginUser.address %>">
                                    </div>
                                    <div class="mb-3">
                                        <label for="cardNumber" class="form-label">Card Number</label>
                                        <input type="text" class="form-control" id="cardNumber" pattern="\d{16}" title="Card number must be 16 digits" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="expiryDate" class="form-label">Expiry Date</label>
                                        <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY" pattern="(0[1-9]|1[0-2])\/\d{2}" title="Expiry date must be in MM/YY format" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="cvv" class="form-label">CVV</label>
                                        <input type="text" class="form-control" id="cvv" pattern="\d{3}" title="CVV must be 3 digits" required>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div id="orderPlaced"></div>
                        <div class="text-right">
                            <button onclick="call()" class="main-btn order-btn">Order now !!</button>
                        </div>
                        
                    </div>

                </div>

            </div>
        </div>
    </section>

    <script>
        function toggleForms() {
            document.getElementById('cashOnDeliveryForm').style.display = document.getElementById('offline').checked ? 'block' : 'none';
            document.getElementById('onlinePaymentForm').style.display = document.getElementById('online').checked ? 'block' : 'none';
        }

        function call() {
            if (localStorage.length != 0) {
                var paymentType = '';
                if (document.getElementById('offline').checked)
                    paymentType = 'cash on delivery';
                else if (document.getElementById('online').checked)
                    paymentType = 'online';
                else {
                    Swal.fire({
                        title: 'Please select payment type',
                        icon: 'info',
                        confirmButtonText: 'Ok!'
                    })
                    return;
                }

                $.ajax({
                    type: 'POST',
                    url: '/orderNowFromBasket',
                    data: { data: localStorage.getItem('cart'), paymentType: paymentType },
                    success: function (data) {
                        localStorage.clear();
                        document.getElementById("orderPlaced").innerHTML = `<div class="text-success px-3">Your order is successfully placed...</div>`;
                    },
                    error: function (data) {
                        Swal.fire({
                            title: 'Error Occurred!!',
                            text: 'This order is not placed, something went wrong. Sorry for the issue...',
                            icon: 'error',
                            confirmButtonText: 'Ok!'
                        })
                    },
                })
            } else {
                location.assign('/user/orderFood')
            }
        }
    </script>
</body>

</html>
